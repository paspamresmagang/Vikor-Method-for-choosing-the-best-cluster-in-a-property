<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Bukit Podomoro Jakarta</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, rgba(4, 136, 83, 0.1), rgba(255, 255, 255, 0.5));
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Navigation Bar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            background: linear-gradient(to right, #048853, #036944);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a,
        .logout-button {
            color: #fff;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.active,
        .logout-button:hover {
            color: #d1e8d5;
            font-weight: 600;
        }

        /* Sections */
        .section {
            min-height: 100vh;
            padding: 120px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Login Section */
        #adminLogin {
            background: transparent;
        }

        .login-container {
            background: #fff;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            padding: 40px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            text-align: center;
            animation: fadeIn 0.5s ease-in-out;
        }

        .login-container h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #048853;
            margin-bottom: 20px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-form label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }

        .login-form input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-size: 1rem;
            border: 1px solid #ccc;
            transition: border-color 0.3s ease;
        }

        .login-form input:focus {
            border-color: #048853;
            outline: none;
        }

        .login-form button {
            background: #048853;
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s ease;
        }

        .login-form button:hover {
            background: #036944;
        }

        /* Dashboard Section */
        #adminDashboard {
            display: none;
            background: transparent;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #048853;
            margin-bottom: 30px;
            text-align: center;
        }

        .dashboard-container {
            background: #fff;
            border-radius: 15px;
            width: 100%;
            max-width: 1200px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            animation: fadeIn 0.5s ease-in-out;
        }

        .dashboard-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-button {
            background: #e0e0e0;
            border-radius: 8px;
            padding: 10px 20px;
            color: #333;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active,
        .tab-button:hover {
            background: #048853;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Weights Form */
        .weights-form-container {
            margin-bottom: 20px;
        }

        .weights-form-container h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .weights-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            border: 1px solid #ccc;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #048853;
            outline: none;
        }

        .submit-weights {
            background: #048853;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            grid-column: span 2;
            justify-self: center;
            transition: background 0.3s ease;
        }

        .submit-weights:hover {
            background: #036944;
        }

        /* Property Management */
        .property-table,
        .submissions-table,
        .vikor-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        .property-table th,
        .property-table td,
        .submissions-table th,
        .submissions-table td,
        .vikor-table th,
        .vikor-table td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
            font-size: 0.9rem;
        }

        .property-table th,
        .submissions-table th,
        .vikor-table th {
            background: #048853;
            color: #fff;
            font-weight: 600;
        }

        .property-table tr:hover,
        .submissions-table tr:hover,
        .vikor-table tr:hover {
            background: #f5f5f5;
        }

        .action-buttons button {
            padding: 8px 12px;
            margin-right: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .edit-btn {
            background: #007bff;
            color: #fff;
        }

        .delete-btn {
            background: #dc3545;
            color: #fff;
        }

        .action-buttons button:hover {
            opacity: 0.9;
        }

        /* Property Form */
        .property-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .property-form .form-group {
            display: flex;
            flex-direction: column;
        }

        .property-form input,
        .property-form select {
            padding: 12px;
            border-radius: 8px;
            font-size: 1rem;
            border: 1px solid #ccc;
            transition: border-color 0.3s ease;
        }

        .property-form input:focus,
        .property-form select:focus {
            border-color: #048853;
            outline: none;
        }

        .property-form button {
            background: #048853;
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            grid-column: span 2;
            transition: background 0.3s ease;
        }

        .property-form button:hover {
            background: #036944;
        }

        /* VIKOR Results */
        .vikor-results {
            margin-top: 20px;
        }

        .vikor-results h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        /* Footer */
        footer {
            background: linear-gradient(to right, #048853, #036944);
            padding: 20px 0;
            text-align: center;
            font-size: 0.9rem;
            color: #fff;
            position: relative;
            z-index: 1;
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-container {
                max-width: 90%;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 15px 20px;
            }

            .logo {
                font-size: 1.2rem;
            }

            .nav-links {
                gap: 15px;
            }

            .nav-links a,
            .logout-button {
                font-size: 0.9rem;
            }

            .section {
                padding: 80px 20px;
            }

            .section-title {
                font-size: 2rem;
            }

            .property-form,
            .weights-form {
                grid-template-columns: 1fr;
            }

            .property-table,
            .submissions-table,
            .vikor-table {
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .nav-links {
                gap: 10px;
            }

            .login-container {
                padding: 20px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .property-table th,
            .property-table td,
            .submissions-table th,
            .submissions-table td,
            .vikor-table th,
            .vikor-table td {
                padding: 6px;
                font-size: 0.8rem;
            }

            .action-buttons button {
                padding: 6px 8px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar" aria-label="Admin navigation">
        <div class="logo">Admin - Bukit Podomoro Jakarta</div>
        <div class="nav-links">
            <a href="#adminLogin" class="active">Login</a>
            <a href="#adminDashboard" id="dashboardLink" style="display: none;">Dashboard</a>
            <button class="logout-button" onclick="logout()" aria-label="Logout">Logout</button>
        </div>
    </nav>

    <!-- Admin Login Section -->
    <section id="adminLogin" class="section" aria-labelledby="admin-login-title">
        <div class="login-container">
            <h2 id="admin-login-title">Admin Login</h2>
            <form id="adminLoginForm" class="login-form">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" name="username" placeholder="Enter username" required
                        aria-required="true">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" name="password" placeholder="Enter password" required
                        aria-required="true">
                </div>
                <button type="submit">Login</button>
            </form>
        </div>
    </section>

    <!-- Admin Dashboard Section -->
    <section id="adminDashboard" class="section" aria-labelledby="dashboard-title">
        <h2 class="section-title" id="dashboard-title">Admin Dashboard</h2>
        <div class="dashboard-container">
            <div class="dashboard-tabs">
                <button class="tab-button active" onclick="showTab('propertiesTab')">Manage Properties</button>
                <button class="tab-button" onclick="showTab('submissionsTab')">User Submissions</button>
                <button class="tab-button" onclick="showTab('vikorTab')">VIKOR Ranking</button>
            </div>


            <!-- kalo mau nambah prop -->
            <div id="propertiesTab" class="tab-content active">
                <h3>Manage Properties</h3>
                <form id="propertyForm" class="property-form">
                    <div class="form-group">
                        <label for="propertyType">Property Type</label>
                        <input type="text" id="propertyType" name="thename" required>
                    </div>
                    <div class="form-group">
                        <label for="propertyPrice">Price (IDR)</label>
                        <input type="number" id="propertyPrice" name="price" required>
                    </div>

                    <!-- dari sini dibentuk lah tipe rumah -->
                    <div class="form-group">
                        <label for="propertyArea">Building Area (mÂ²)</label>
                        <input type="number" id="propertyArea" name="area" placeholder="e.g., 36" required>
                    </div>
                    <div class="form-group">
                        <label for="propertyTanah">Land Area (mÂ²)</label>
                        <input type="number" id="propertyTanah" name="tanah" placeholder="e.g., 60" required>
                    </div>

                    <!-- kamar dan capacity harus sesuai. kamar besar = 2 dan kamar kecil 1 -->
                    <div class="form-group">
                        <label for="propertyBedrooms">Bedroom Configuration</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="bigRoom" name="bigRoom" placeholder="Kamar Besar" min="0" required>
                            <input type="number" id="smallRoom" name="smallRoom" placeholder="Kamar Kecil" min="0"
                                required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="propertyCapacity">Capacity</label>
                        <select id="propertyCapacity" name="capacity" required>
                            <option value="3">3 orang</option>
                            <option value="4">4 orang</option>
                            <option value="5">5 orang</option>
                            <option value="6">6 orang</option>
                            <option value="7">7 orang</option>
                            <option value="8">8 orang</option>
                            <option value="9">9 orang</option>
                        </select>
                    </div>


                    <div class="form-group">
                        <label for="propertyAksesbilitas">Accessibility</label>
                        <select id="propertyAksesbilitas" name="aksesbilitas" required>
                            <option value="dekat">Dekat</option>
                            <option value="sedang">Sedang</option>
                            <option value="belakang">Belakang</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propertyJenis">House Type</label>
                        <select id="propertyJenis" name="jenis" required>
                            <option value="biasa">Biasa</option>
                            <option value="smart">Smart</option>
                        </select>
                    </div>
                    <input type="hidden" id="propertyIndex" name="index">
                    <button type="submit">Add Property</button>
                </form>

                <!-- //current database -->
                <table class="property-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Price (IDR)</th>
                            <th>Building Area</th>
                            <th>Bedroom Configuration</th>
                            <th>Capacity</th>
                            <th>Accessibility</th>
                            <th>House Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="propertyTableBody"></tbody>
                </table>
            </div>


            <div id="submissionsTab" class="tab-content">
                <h3>User Submissions</h3>
                <table class="submissions-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Question</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="submissionsTableBody"></tbody>
                </table>
            </div>


            <!-- // 3. penghitungan vikor -->
            <div id="vikorTab" class="tab-content">
                <h3>VIKOR Ranking</h3>
                <div class="weights-form-container">
                    <h3>Enter Criteria Weights</h3>

                    <form id="weightsForm" class="weights-form" onsubmit="calculateVIKOR(event)">
                        <div class="form-group">
                            <label for="weightPrice">Price (0-1)</label>
                            <input type="number" id="weightPrice" name="weightPrice" step="0.01" min="0" max="1"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="weightBedrooms">Bedroom Configuration (0-1)</label>
                            <input type="number" id="weightBedrooms" name="weightBedrooms" step="0.01" min="0" max="1"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="weightCapacity">Capacity (0-1)</label>
                            <input type="number" id="weightCapacity" name="weightCapacity" step="0.01" min="0" max="1"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="weightArea">Building Area (0-1)</label>
                            <input type="number" id="weightArea" name="weightArea" step="0.01" min="0" max="1" required>
                        </div>
                        <div class="form-group">
                            <label for="weightAksesbilitas">Accessibility (0-1)</label>
                            <input type="number" id="weightAksesbilitas" name="weightAksesbilitas" step="0.01" min="0"
                                max="1" required>
                        </div>
                        <div class="form-group">
                            <label for="weightJenis">House Type (0-1)</label>
                            <input type="number" id="weightJenis" name="weightJenis" step="0.01" min="0" max="1"
                                required>
                        </div>
                        <button type="submit" class="submit-weights">Calculate VIKOR</button>
                    </form>

                </div>


                <!-- //ini hasilnya -->
                <div class="vikor-results" id="vikorResults" style="display: none;">
                    <h3>VIKOR Calculation Results</h3>
                    <table class="vikor-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>S</th>
                                <th>R</th>
                                <th>Q</th>
                                <th>Rank</th>
                            </tr>
                        </thead>
                        <tbody id="vikorTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer aria-label="Footer">
        <div>Copyright by Bukit Podomoro Jakarta All Right Reserved</div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCilujrvY-Tg9yIPT-ccI8XcP6UxX7mLz8",
            authDomain: "spk-jual-beli-rumah.firebaseapp.com",
            projectId: "spk-jual-beli-rumah",
            storageBucket: "spk-jual-beli-rumah.firebasestorage.app",
            messagingSenderId: "746591086922",
            appId: "1:746591086922:web:b514f431d2944d016c39b3",
            measurementId: "G-H5N70PJPQV"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Add or update property
        function addOrUpdateProperty(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const bigRoom = parseInt(document.getElementById('bigRoom').value) || 0;
            const smallRoom = parseInt(document.getElementById('smallRoom').value) || 0;
            const capacity = parseInt(formData.get('capacity'));

            const totalKapasitas = (bigRoom * 2) + (smallRoom * 1);

            if (totalKapasitas !== capacity) {
                alert(`Jumlah kapasitas (${capacity} orang) tidak sesuai dengan jumlah kamar. Total kapasitas dari kamar: ${totalKapasitas} orang.`);
                return false;
            }

            return true;

            // form.reset();
            // form.querySelector('#propertyIndex').value = '';
            // form.querySelector('button').textContent = 'Add Property';
            // updatePropertyTable();
        }

        document.getElementById("propertyForm").addEventListener("submit", async function (event) {
            const isValid = addOrUpdateProperty(event);
            if (!isValid) return;

            const formData = new FormData(event.target);
            const namaa = formData.get('thename');

            //C1 (harga)
            let harga = [
                { max: 1500000000, skor: 5 },
                { min: 1500000001, max: 2500000000, skor: 4 },
                { min: 2500000001, max: 3500000000, skor: 3 },
                { min: 3500000001, max: 4500000000, skor: 2 },
                { min: 4500000001, max: Infinity, skor: 1 }
            ];
            const price = parseInt(formData.get('price')); // misalnya dari input form
            const skorC1 = (harga.find(h => price >= (h.min ?? 0) && price <= h.max))?.skor ?? 0;

            //C4 tipe rumah
            let tipe = [
                { max: 60, skor: 5 },
                { min: 61, max: 100, skor: 4 },
                { min: 101, max: 150, skor: 3 },
                { min: 151, max: 200, skor: 2 },
                { min: 201, max: Infinity, skor: 1 }
            ];
            const buildingArea = parseInt(formData.get('area')); // ini LB
            const skorC4 = tipe.find(t => buildingArea >= (t.min || 0) && buildingArea <= t.max).skor ?? 0;



            //C3 kapasitas
            let kapasitas = [
                { max: 3, skor: 1 },
                { min: 4, max: 6, skor: 2 },
                { min: 7, max: Infinity, skor: 3 }
            ];
            const capacity = parseInt(formData.get('capacity')); // ini LB
            const skorC3 = kapasitas.find(t => capacity >= (t.min || 0) && capacity <= t.max).skor;

            //C2 konfigurasi kamar
            let konfigurasiKamar = [
                { big: 1, small: 1, skor: 1 },
                { big: 0, small: 3, skor: 2 },
                { big: 2, small: 0, skor: 3 },
                { big: 1, small: 2, skor: 4 },
                { big: 1, small: 3, skor: 5 },
                { big: 3, small: 0, skor: 6 },
                { big: 2, small: 2, skor: 7 },
                { big: 3, small: 1, skor: 8 },
                { big: 4, small: 1, skor: 9 },
                { big: 3, small: 2, skor: 10 }
            ];
            const bigRoom = parseInt(document.getElementById('bigRoom').value) || 0;
            const smallRoom = parseInt(document.getElementById('smallRoom').value) || 0;

            const matchedKonfigurasi = konfigurasiKamar.find(k => k.big === bigRoom && k.small === smallRoom);
            const skorC2 = matchedKonfigurasi ? matchedKonfigurasi.skor : 0;
            //C5 aksesbilitas
            let aksesbilitas = [
                { jarak: "dekat", skor: 3 },
                { jarak: "sedang", skor: 2 },
                { jarak: "belakang", skor: 1 }
            ];
            const inputJarak = document.getElementById('propertyAksesbilitas').value;
            const jarak = aksesbilitas.find(k => k.jarak === inputJarak);
            const skorC5 = jarak ? jarak.skor : 0;

            //C6 tipe rumah
            let house_type = [
                { type: "biasa", skor: 1 },
                { type: "smart", skor: 2 }
            ];
            const inputTYPE = document.getElementById('propertyJenis').value;
            const type = house_type.find(k => k.type === inputTYPE);
            const skorC6 = type ? type.skor : 0;

            // ðŸ”¥ Simpan data minimal ke Firestore
            try {
                await addDoc(collection(db, "clusterVi"), {
                    cHarga: skorC1,
                    cKamar: skorC2,
                    cKapasitas: skorC3,
                    cTipe: skorC4,
                    cDistance: skorC5,
                    cJenis: skorC6,
                    nama: namaa
                });
                alert("Data cluster berhasil disimpan!");
                event.target.reset();
                loadPropertyTable();
            } catch (err) {
                alert("Gagal menyimpan data: " + err.message);
            }
        });
        window.addEventListener('DOMContentLoaded', () => {
            loadPropertyTable();
        });


        // Handle admin login
        document.getElementById("adminLoginForm").addEventListener("submit", handleLogin);
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();

            if (username === "admin" && password === "admin123") {
                sessionStorage.setItem('isAdminLoggedIn', 'true');
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'flex';
                document.getElementById('dashboardLink').style.display = 'block';
                document.querySelector('.nav-links a[href="#adminLogin"]').classList.remove('active');
                document.querySelector('.nav-links a[href="#adminDashboard"]').classList.add('active');
                document.getElementById('adminDashboard').scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Invalid username or password');
            }
        }

        // Logout function
        function logout() {
            sessionStorage.removeItem('isAdminLoggedIn');
            document.getElementById('adminLogin').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('dashboardLink').style.display = 'none';
            document.querySelector('.nav-links a[href="#adminDashboard"]').classList.remove('active');
            document.querySelector('.nav-links a[href="#adminLogin"]').classList.add('active');
            document.getElementById('adminLoginForm').reset();
            document.getElementById('adminLogin').scrollIntoView({ behavior: 'smooth' });
            alert('Logged out successfully.');
        }


        // pembobotan dari input
        async function loadPropertyTable() {
            const tableBody = document.getElementById("propertyTableBody");
            tableBody.innerHTML = ""; // bersihin dulu isinya biar gak dobel

            try {
                const querySnapshot = await getDocs(collection(db, "clusterVi"));
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const row = document.createElement("tr");

                    row.innerHTML = `
                <td>${data.nama || '-'}</td>
                <td>${data.cHarga || '-'}</td>
                <td>${data.cTipe || '-'}</td>
                <td>${data.cKamar || '-'}</td>
                <td>${data.cKapasitas || '-'}</td>
                <td>${data.cDistance || '-'}</td>
                <td>${data.cJenis || '-'}</td>
                <td>
                    <button onclick="deleteEntry('${doc.id}')">ðŸ—‘</button>
                </td>
            `;

                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading data:", error);
            }
        }

        // Simulated user submissions storage
        let submissions = JSON.parse(localStorage.getItem('submissions')) || [];


        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');
        }
        window.showTab = showTab;

        // Simulate form submissions from user site
        function handleFormSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const email = form.querySelector('input[name="email"]').value.trim();
            const question = form.querySelector('textarea[name="question"]').value.trim();
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!emailPattern.test(email)) {
                alert('Please enter a valid email address.');
                return false;
            }
            if (!question) {
                alert('Please enter your question.');
                return false;
            }

            const submission = {
                email,
                question,
                date: new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' })
            };
            submissions.push(submission);
            localStorage.setItem('submissions', JSON.stringify(submissions));
            // alert("Thank you Email" ${email}\nQuestion: ${question});
            form.reset();
            updateSubmissionsTable();
            return false;
        }

        async function calculateVIKOR(event) {
            event.preventDefault();

            const weights = {
                price: parseFloat(document.getElementById("weightPrice").value),
                bedrooms: parseFloat(document.getElementById("weightBedrooms").value),
                capacity: parseFloat(document.getElementById("weightCapacity").value),
                area: parseFloat(document.getElementById("weightArea").value),
                akses: parseFloat(document.getElementById("weightAksesbilitas").value),
                jenis: parseFloat(document.getElementById("weightJenis").value),
            };

            try {
                const snapshot = await getDocs(collection(db, "clusterVi"));
                const data = [];

                snapshot.forEach((doc) => {
                    const d = doc.data();
                    data.push({
                        type: d.nama,
                        criteria: [
                            parseFloat(d.cHarga),
                            parseFloat(d.cKamar),
                            parseFloat(d.cKapasitas),
                            parseFloat(d.cTipe),
                            parseFloat(d.cDistance),
                            parseFloat(d.cJenis),
                        ],
                    });
                });

                const fMax = Array(6).fill(-Infinity);
                const fMin = Array(6).fill(Infinity);
                data.forEach((item) => {
                    item.criteria.forEach((val, i) => {
                        if (val > fMax[i]) fMax[i] = val;
                        if (val < fMin[i]) fMin[i] = val;
                    });
                });

                data.forEach((item) => {
                    item.normalized = item.criteria.map((val, i) => {
                        return (fMax[i] - val) / (fMax[i] - fMin[i]); // treat semua sebagai cost
                    });
                });

                const weighted = data.map((item) => {
                    const v = item.normalized.map((val, i) => val * Object.values(weights)[i]);
                    const S = v.reduce((a, b) => a + b, 0);
                    const R = Math.max(...v);
                    return { ...item, v, S, R };
                });

                const Smin = Math.min(...weighted.map((w) => w.S));
                const Smax = Math.max(...weighted.map((w) => w.S));
                const Rmin = Math.min(...weighted.map((w) => w.R));
                const Rmax = Math.max(...weighted.map((w) => w.R));

                const vFactor = 0.5;
                weighted.forEach((item) => {
                    item.Q = vFactor * ((item.S - Smin) / (Smax - Smin)) +
                        (1 - vFactor) * ((item.R - Rmin) / (Rmax - Rmin));
                });

                weighted.sort((a, b) => a.Q - b.Q);
                weighted.forEach((w, i) => w.rank = i + 1);

                const tbody = document.getElementById("vikorTableBody");
                tbody.innerHTML = "";
                weighted.forEach((w) => {
                    tbody.innerHTML += `
                <tr>
                    <td>${w.type}</td>
                    <td>${w.S.toFixed(3)}</td>
                    <td>${w.R.toFixed(3)}</td>
                    <td>${w.Q.toFixed(3)}</td>
                    <td>${w.rank}</td>
                </tr>`;
                });

                document.getElementById("vikorResults").style.display = "block";

            } catch (err) {
                console.error("Error VIKOR:", err);
                alert("Gagal hitung VIKOR, cek Firestore atau struktur data!");
            }
        }
        window.calculateVIKOR = calculateVIKOR;
    </script>
</body>

</html>